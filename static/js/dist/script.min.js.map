{"version":3,"sources":["script.js"],"names":["$","document","ready","prepend","on","menu","this","next","hasClass","removeClass","addClass","jQuery","addEventListener","footerLink","getElementById","closeLightbox","event","preventDefault","lightbox","classList","remove","css","add","window","load","data","title","loc","geoJsonData","getJsonData","map_id","position","getPositionFromHash","zoom","center_lon","center_lat","center","targetIcon","L","icon","iconUrl","iconSize","shadowSize","iconAnchor","shadowAnchor","popupAnchor","center_tiles","getTileURL","markers","markerClusterGroup","geoJsonLayer","geoJson","onEachFeature","feature","layer","addLayer","bindPopup","properties","text","drawControl","Control","Draw","draw","polygon","polyline","rectangle","circle","edit","featureGroup","osmclassic_url","osmclassic_attribution","osm_classic","tileLayer","attribution","zoomMin","zoomMax","baseLayers","TileLayer","osm_minimap","Hash","e","type","layerType","lat","_latlng","lon","lng","id","_leaflet_id","saveIt","tweettext","insertItem","console","openPopup","maxCount","val","params","href","via","simplyCountable","attr","param","click","layers","_layers","twitterBaselink","JSON","stringify","key","deleted_item","mapAdd","gps","Gps","searchNominatim","query","map","getCenter","marker","closePopup","response","json","display_name","String","item","parseFloat","error","_context","t0","searchLocations","callResponse","nominatimResults","sampleDataResults","combinedResults","regeneratorRuntime","async","_context2","prev","awrap","sent","filter","toLowerCase","includes","concat","_toConsumableArray","result","stop","deleteItem","addTo","searchControl","control","search","sourceData","then","results","propertyName","propertyLoc","circleMarker","radius","autoCollapse","autoType","minLength","filterData","records","newText","regSearch","RegExp","replace","elem","test","locate","setView","location","hash","url","latLng","markersLayer","LayerGroup","i","Marker","addControl","Search","container","initial","collapsed","textPlaceholder"],"mappings":"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","file":"script.min.js","sourcesContent":["( function( $ ) {\r\n$( document ).ready(function() {\r\n$('#cssmenu').prepend('<div id=\"menu-button\">Menu</div>');\r\n\t$('#cssmenu #menu-button').on('click', function(){\r\n\t\tvar menu = $(this).next('ul');\r\n\t\tif (menu.hasClass('open')) {\r\n\t\t\tmenu.removeClass('open');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tmenu.addClass('open');\r\n\t\t}\r\n\t});\r\n});\r\n} )( jQuery );\r\n// privacy popup\r\ndocument.addEventListener(\"DOMContentLoaded\", function () {\r\n  const footerLink = document.getElementById(\"footer-link\");\r\n  const lightbox = document.getElementById(\"lightbox\");\r\n  const closeLightbox = document.getElementById(\"close-lightbox\");\r\n\r\n  footerLink.addEventListener(\"click\", function (event) {\r\n    event.preventDefault();\r\n    lightbox.classList.remove(\"lightbox-hidden\");\r\n    $(\"body\").css(\"overflow\", \"hidden\");\r\n  });\r\nif(closeLightbox){\r\n  closeLightbox.addEventListener(\"click\", function () {\r\n    lightbox.classList.add(\"lightbox-hidden\");\r\n    $(\"body\").css(\"overflow\", \"auto\"); // 还原主背景的overflow属性\r\n  });}\r\n\r\n  window.addEventListener(\"click\", function (event) {\r\n    if (event.target === lightbox) {\r\n      lightbox.classList.add(\"lightbox-hidden\");\r\n      $(\"body\").css(\"overflow\", \"auto\"); // 还原主背景的overflow属性\r\n    }\r\n  });\r\n});\r\n//load term of use page in footer \r\n\r\n$(document).ready(function() {\r\n  // 当点击\"terms of use\"链接时，使用jQuery的.load()方法加载terms of use文件\r\n  $(\"#footer-terms-link\").on(\"click\", function(event) {\r\n    event.preventDefault(); // 阻止链接的默认行为\r\n    \r\n    // 使用.load()方法加载terms of use文件，并将其插入到id为\"terms-container\"的div中\r\n    $(\"#terms-container\").load($(this).data(\"target\"));\r\n  });\r\n});\r\n\r\n\r\n\r\n//sample data values for populate map\r\nvar data = [\r\n  {\"loc\":[41.575330,13.102411], \"title\":\"aquamarine\"},\r\n  {\"loc\":[41.575730,13.002411], \"title\":\"black\"},\r\n  {\"loc\":[41.807149,13.162994], \"title\":\"blue\"},\r\n  {\"loc\":[41.507149,13.172994], \"title\":\"chocolate\"},\r\n  {\"loc\":[41.847149,14.132994], \"title\":\"coral\"},\r\n  {\"loc\":[41.219190,13.062145], \"title\":\"cyan\"},\r\n  {\"loc\":[41.344190,13.242145], \"title\":\"darkblue\"},\t\r\n  {\"loc\":[41.679190,13.122145], \"title\":\"darkred\"},\r\n  {\"loc\":[41.329190,13.192145], \"title\":\"darkgray\"},\r\n  {\"loc\":[41.379290,13.122545], \"title\":\"dodgerblue\"},\r\n  {\"loc\":[41.409190,13.362145], \"title\":\"gray\"},\r\n  {\"loc\":[41.794008,12.583884], \"title\":\"green\"},\t\r\n  {\"loc\":[41.805008,12.982884], \"title\":\"greenyellow\"},\r\n  {\"loc\":[41.536175,13.273590], \"title\":\"red\"},\r\n  {\"loc\":[41.516175,13.373590], \"title\":\"rosybrown\"},\r\n  {\"loc\":[41.506175,13.173590], \"title\":\"royalblue\"},\r\n  {\"loc\":[41.836175,13.673590], \"title\":\"salmon\"},\r\n  {\"loc\":[41.796175,13.570590], \"title\":\"seagreen\"},\r\n  {\"loc\":[41.436175,13.573590], \"title\":\"seashell\"},\r\n  {\"loc\":[41.336175,13.973590], \"title\":\"silver\"},\r\n  {\"loc\":[41.236175,13.273590], \"title\":\"skyblue\"},\r\n  {\"loc\":[41.546175,13.473590], \"title\":\"yellow\"},\r\n  {\"loc\":[41.239190,13.032145], \"title\":\"white\"}\r\n];\r\n  var geoJsonData = getJsonData();\r\n  var map_id = geoJsonData['id'];\r\nvar position = getPositionFromHash();\r\n  var zoom = position[0];\r\n  var center_lon = position[1];\r\n  var center_lat = position[2];\r\n\r\n  var center = [center_lat, center_lon];\r\n  var targetIcon = new L.icon({\r\n      iconUrl: './images/target_32x32.png',\r\n      iconSize:     [32, 32],\r\n      shadowSize:   [50, 64],\r\n      iconAnchor:   [12, 41],\r\n      shadowAnchor: [4, 62],\r\n      popupAnchor:  [3, -33]\r\n  });\r\n\r\n  var center_tiles = getTileURL(center[0], center[1], zoom);\r\n\r\n  var markers = L.markerClusterGroup();\r\n\r\n  var geoJsonLayer = L.geoJson(geoJsonData, {\r\n      onEachFeature: function (feature, layer) {\r\n          markers.addLayer(layer);\r\n          layer.bindPopup(feature.properties.text);\r\n      }\r\n  });\r\n\r\n\r\n  var drawControl = new L.Control.Draw({\r\n      draw: {\r\n          position: 'topleft',\r\n          polygon : false,\r\n          polyline : false,\r\n          rectangle : false,\r\n          circle : false\r\n      },\r\n      edit: {\r\n          featureGroup: markers\r\n      }\r\n  });\r\n\r\n\r\n//create map for user to add their own location\r\nvar osmclassic_url = 'http://{s}.tile.osm.org/{z}/{x}/{y}.png';\r\nvar osmclassic_attribution = 'Map data &copy; <a href=\"http://osm.org/copyright\">' +\r\n  'OpenStreetMap</a> contributors, Imagery &copy; OpenStreetMap';\r\nvar osm_classic = L.tileLayer(osmclassic_url, {\r\n      attribution: osmclassic_attribution,\r\n      zoomMin: 2,\r\n      zoomMax: 18\r\n  });\r\nvar baseLayers = {\r\n      \"OSM oggi\": osm_classic,\r\n  };\r\n\r\nvar mapAdd = L.map('mapAdd', {\r\n      layers: [osm_classic],\r\n      center: center,\r\n      zoom: zoom\r\n  });\r\nmapAdd.addControl(drawControl);\r\n\r\n// minimappa\r\n  var osm_minimap = new L.TileLayer(osmclassic_url, {\r\n      minZoom: 0,\r\n      maxZoom: 13\r\n  });\r\n  var miniMap = new L.Control.MiniMap(osm_minimap, {\r\n      toggleDisplay: true\r\n  }).addTo(mapAdd);\r\n\r\n  // hash\r\n  var hash = new L.Hash(mapAdd);\r\n\r\n\r\n\r\n\r\n /*\r\n  * Draw events on map1:\r\n  * * draw:created is fired on node creation\r\n  * * draw:deleted is fired on node deletion (when saving)\r\n  */\r\n\r\n  mapAdd.on('draw:created', function (e) {\r\n      console.log('draw:created');\r\n\r\n      var type = e.layerType,\r\n          layer = e.layer;\r\n\r\n      // drawnItems.addLayer(layer);\r\n      markers.addLayer(layer);\r\n\r\n      var lat = layer._latlng.lat;\r\n      var lon = layer._latlng.lng;\r\n      var id = layer._leaflet_id;\r\n\r\n\r\n      function saveIt(tweettext) {\r\n          insertItem(lat, lon, map_id, id, tweettext);\r\n          layer.closePopup();\r\n          layer.bindPopup(tweettext);\r\n\r\n      }\r\n      \r\n      if (type === 'marker') {\r\n        var form = '<form id=\"inputform\" enctype=\"multipart/form-data\">' +\r\n            '<h4>footprint 1</h4>' +\r\n            '<textarea class=\"form-control\" placeholder=\"Il tuo tweet\" id=\"tweet-text\" name=\"tweet-text\" style=\"font-size: small;\" row=5>' +\r\n              \"film information and my travel #OpenStreetMap!\" +\r\n            '</textarea>' +\r\n            '<div class=\"row-fluid\" style=\"text-align: right;\">' +\r\n              'caratteri: <span id=\"counter\"></span>' +\r\n            '</div>' +\r\n            '<div class=\"row-fluid\">' +\r\n                '<a role=\"button\" class=\"btn save-button\" id=\"save\" title=\"save your footprint\"></a>' +\r\n                '<a role=\"button\" class=\"btn tweet-button\" id=\"tweet\"' +\r\n                    'href=\"https://twitter.com/intent/tweet?via=OpenStreeMapIt&text=L%27agenzia%20delle%20entrate%20copia%20da%20OpenStreetMap!\" ' +\r\n                    'title=\"Save inserted and twittered point!\"></a>' +\r\n            '</div>' +\r\n            '</form>';\r\n\r\n        layer.bindPopup(form).openPopup();\r\n\r\n        $('#tweet').simplyCountable({\r\n          maxCount: 97,\r\n        });\r\n      }\r\n\r\n      $('#save').click(function() {\r\n          var tweettext = $('textarea#tweet-text').val();\r\n          saveIt(tweettext);\r\n      });\r\n\r\n      $('#tweet').click(function tweetIt(event) {\r\n          event.preventDefault();\r\n          var tweettext = $('textarea#tweet-text').val();\r\n          var twitterBaselink = \"https://twitter.com/intent/tweet?\";\r\n          var params = {\r\n              url: window.location.href,\r\n              via: 'OpenStreetMapIt',\r\n              text: tweettext\r\n          };\r\n\r\n          $('#tweet').attr('href', twitterBaselink + $.param(params));\r\n          saveIt(tweettext);\r\n      });\r\n\r\n  });\r\n \r\n  mapAdd.on('draw:deleted', function (e) {\r\n      for ( var key in e.layers._layers ){\r\n        var deleted_item = JSON.stringify(e.layers._layers[key].feature);\r\n        deleteItem(deleted_item, map_id);\r\n      }\r\n  });\r\n\r\n  mapAdd.addLayer(markers);\r\n//定位当前位置\r\n\r\nvar gps = new L.Control.Gps({\r\n  //autoActive:true,\r\n  autoCenter:true\r\n});//inizialize control\r\n\r\ngps\r\n.on('gps:located', function(e) {\r\n  //\te.marker.bindPopup(e.latlng.toString()).openPopup()\r\n  console.log(e.latlng, map.getCenter())\r\n})\r\n.on('gps:disabled', function(e) {\r\n  e.marker.closePopup()\r\n});\r\n\r\ngps.addTo(mapAdd);\r\n  async function searchNominatim(query) {\r\ntry {\r\n  const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}`, {\r\n    headers: {\r\n      Accept: 'application/json',\r\n    },\r\n  });\r\n  const data = await response.json();\r\n  return data.map((item) => ({\r\n    display_name: String(item.display_name),\r\n    lat: parseFloat(item.lat),\r\n    lon: parseFloat(item.lon),\r\n  }));\r\n} catch (error) {\r\n  console.error(error);\r\n}\r\n}\r\n\r\n\r\n// 添加新的搜索方法，将 Nominatim 结果与样本数据一起返回\r\nasync function searchLocations(text, callResponse) {\r\nconst nominatimResults = await searchNominatim(text);\r\nconst sampleDataResults = data.filter((item) => item.title.toLowerCase().includes(text.toLowerCase()));\r\n\r\nconst combinedResults = [\r\n  ...nominatimResults.map((result) => ({\r\n    display_name: result.display_name,\r\n    loc: [result.lat, result.lon],\r\n  })),\r\n  ...sampleDataResults.map((result) => ({\r\n    display_name: result.title,\r\n    loc: result.loc,\r\n  })),\r\n];\r\n\r\ncallResponse(combinedResults);\r\n}\r\n\r\n// 更新搜索控件，使用新的搜索方法\r\nvar searchControl = L.control.search({\r\nsourceData: function (text, callResponse) {\r\n  searchNominatim(text).then((results) => {\r\n    callResponse(results);\r\n  });\r\n},\r\npropertyName: 'display_name',\r\npropertyLoc: ['lat', 'lon'],\r\nmarker: L.circleMarker([0, 0], { radius: 30 }),\r\nautoCollapse: true,\r\nautoType: false,\r\nminLength: 2,\r\nfilterData: function (text, records) {\r\n  var newText = String(text);\r\n  var regSearch = new RegExp(newText.replace(/[.?*+^$[\\]\\\\(){}|-]/g, '\\\\$&'), 'i');\r\n  return records.filter(function (elem) {\r\n    return regSearch.test(elem.display_name);\r\n  });\r\n},\r\n}).addTo(mapAdd);\r\n\r\n\r\n// 其他代码与原代码相同\r\n\r\n\r\n  /*\r\n  * Geolocation on the map\r\n  */\r\n\r\n\r\n\r\n  $('#locate-me').click(function() {\r\n      mapAdd.locate({setView: true});\r\n  });\r\n\r\n  /*\r\n  * Update links under the map\r\n  */\r\n  $('.note > a#reportmap-fullscreen').click(function() {\r\n      $( this ).attr('href', '/reportmap.html' + window.location.hash);\r\n  });\r\n\r\n/*\r\n  * Tweet link\r\n  */\r\n  $('.tweet-link').click(function() {\r\n       var twitterBaselink = \"https://twitter.com/intent/tweet?\";\r\n       var params = {\r\n          url: window.location.href,\r\n          via: 'OpenStreeMapIt',\r\n          text: \"L'agenzia delle entrate copia da OpenStreetMap! #agenziauscite\"\r\n      };\r\n\r\n      $( this ).attr('href', twitterBaselink + $.param(params));\r\n  });\r\n\r\n\r\nvar map = new L.Map('map', {zoom: 9, center: new L.latLng(data[0].loc) });\t//set center from first location\r\n\r\n\r\n   // 添加 OpenStreetMap 图层\r\n   L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n      attribution: '&copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors',\r\n      maxZoom: 19\r\n    }).addTo(map);\r\n\r\n  var markersLayer = new L.LayerGroup();\t//layer contain searched elements\r\nmap.addLayer(markersLayer);\r\n\r\n\r\n\r\n////////////populate map with markers from sample data\r\nfor(i in data) {\r\n  var title = data[i].title,\t//value searched\r\n    loc = data[i].loc,\t\t//position found\r\n    marker = new L.Marker(new L.latLng(loc), {title: title} );//se property searched\r\n  marker.bindPopup('title: '+ title );\r\n  markersLayer.addLayer(marker);\r\n}\r\n\r\nmap.addControl( new L.Control.Search({\r\n  container: 'findbox',\r\n  layer: markersLayer,\r\n  initial: false,\r\n  collapsed: false,\r\n  textPlaceholder: 'search for a movie ',\r\n  textErr: 'Sorry, no results found.',\r\n\r\n}) );\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  "]}