{"version":3,"sources":["worstnightmare.js"],"names":["REMOTE_BASEURL","window","location","hostname","Number","prototype","toRad","Math","PI","findWithAttr","layers","attr","value","layer_id","findGeopoiLayer","e","geopoi_url","geopoi_layer","target","_layers","map_layers_array","_map","_syncMaps","map_layer_id","getTileURL","lat","lon","zoom","xtile","parseInt","floor","ytile","log","tan","cos","movemarker","position","getCenter","toFixed","lng","marker_center_left","setLatLng","marker_center_right","tiles","_zoom","options","xtile_center","ytile_center","setUrl","$","text","dragstartmarker","onLocationFound","radius","accuracy","gemIcon","L","icon","iconUrl","iconSize","map","marker","latlng","addTo","circle","onLocationError","alert","message","getPositionFromHash","arr","hash","split","replace","jQuery","isNumeric","getURLParameter","sParam","sPageURL","search","substring","sURLVariables","i","sParameterName","length","toggleIt","element","slideToggle"],"mappings":"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","sourcesContent":["/*!\n * Copyright 2014 Fondazione Bruno Kessler\n * Author: Cristian Consonni\n * Released under the MIT license\n *\n */\nvar REMOTE_BASEURL;\nif ( window.location.hostname === 'localhost' ) {\n    REMOTE_BASEURL = '//localhost:5500/';\n}\nelse {\n    REMOTE_BASEURL = '//reportmap-cristiancantoro.rhcloud.com/';\n}\n \nif ( typeof (Number.prototype.toRad) === \"undefined\" ) {\n  Number.prototype.toRad = function() {\n    return this * Math.PI / 180;\n  };\n}\n\nfunction findWithAttr(layers, attr, value) {\n\n    for ( var layer_id in layers ) {\n        if ( layers[layer_id][attr] === value ) {\n            return layers[layer_id];\n        }\n    }\n}\n\nfunction findGeopoiLayer(e, geopoi_url) {\n    var geopoi_layer = findWithAttr(e.target._layers, \"_url\", geopoi_url);\n\n    if ( typeof (geopoi_layer) === \"undefined\" ) {\n\n        for ( var layer_id in e.target._layers )  {\n\n            var map_layers_array = e.target._layers[layer_id]._map._syncMaps;\n\n            for ( var map_layer_id in map_layers_array ) {\n                geopoi_layer = findWithAttr(map_layers_array[map_layer_id]._layers, \"_url\", geopoi_url);\n                if ( typeof (geopoi_layer) !== \"undefined\" ) {\n                    break;\n                }\n            }\n\n            if ( typeof (geopoi_layer) !== \"undefined\" ) {\n                    break;\n            }\n        }\n\n    }\n\n    return geopoi_layer;\n}\n\nvar getTileURL = function(lat, lon, zoom) {\n  var xtile = parseInt(Math.floor( (Number(lon) + 180) / 360 * (1<<zoom) ), 10);\n  var ytile = parseInt(Math.floor( (1 - Math.log(Math.tan(Number(lat).toRad()) + 1 / Math.cos(Number(lat).toRad())) / Math.PI) / 2 * (1<<zoom) ), 10);\n  return [xtile, ytile];\n};\n\nvar movemarker = function (e) {\n    var geopoi_layer = findWithAttr(e.target._layers, \"_url\", geopoi_url);\n\n    var position = e.target.getCenter();\n    lat = Number(position['lat']).toFixed(5);\n    lng = Number(position['lng']).toFixed(5);\n\n    if (typeof (marker_center_left) !== 'undefined' ) {\n        marker_center_left.setLatLng(position);\n        marker_center_right.setLatLng(position);\n    }\n\n    tiles = getTileURL(lat, lng, e.target._zoom);\n    xtile = tiles[0];\n    ytile = tiles[1];\n\n    geopoi_layer.options.xtile_center = xtile;\n    geopoi_layer.options.ytile_center = ytile;\n    geopoi_layer.setUrl(geopoi_url);\n    \n    $(\"#final-lat\").text(lat);\n    $(\"#final-lon\").text(lng);\n    $(\"#tile-x\").text(xtile);\n    $(\"#tile-y\").text(ytile);\n};\n\nvar dragstartmarker = function(e) {\n    var geopoi_layer = findGeopoiLayer(e, geopoi_url);\n\n    var position = e.target.getCenter();\n    lat = Number(position['lat']).toFixed(5);\n    lng = Number(position['lng']).toFixed(5);\n\n    if (typeof (marker_center_left) !== 'undefined' ) {\n        marker_center_left.setLatLng(position);\n        marker_center_right.setLatLng(position);\n    }\n\n    tiles = getTileURL(lat, lng, e.target._zoom);\n    xtile = tiles[0];\n    ytile = tiles[1];\n\n    geopoi_layer.options.xtile_center = xtile;\n    geopoi_layer.options.ytile_center = ytile;\n    geopoi_layer.setUrl(geopoi_url);\n\n\n    $(\"#final-lat\").text(lat);\n    $(\"#final-lon\").text(lng);\n    $(\"#tile-x\").text(xtile);\n    $(\"#tile-y\").text(ytile);\n};\n\n/*\n* Geolocation on the map\n*/\nvar onLocationFound = function(e) {\n    var radius = e.accuracy / 2;\n\n    var gemIcon = new L.icon({\n        iconUrl: './images/red_18x18.png' ,\n        iconSize:     [12, 12],\n    });\n\n    var map;\n    for ( var layer_id in e.target._layers )  {\n        map = e.target._layers[layer_id]._map;\n        break;\n    }\n\n    L.marker(e.latlng, {icon: gemIcon}).addTo(map);\n\n    L.circle(e.latlng, radius).addTo(map);\n};\n\nvar onLocationError = function(e) {\n    alert(e.message);\n};\n\n/*\n* Position from the url hash\n*/\nfunction getPositionFromHash() {\n    var arr = window.location.hash.split('/');\n\n    var zoom = arr[0].replace('#', '');\n    var lon = arr[1];\n    var lat = arr[2];\n\n    if ( !jQuery.isNumeric(zoom)  ) {\n        zoom = 6;\n    }\n    if ( !jQuery.isNumeric(lon)  ) {\n        lon = 42.302;\n    }\n    if ( !jQuery.isNumeric(lat)  ) {\n        lat = 10.261;\n    }\n    return [zoom, lat, lon];\n}\n\n/*\n* Get url parameters\n* taken from:\n* http://www.jquerybyexample.net/2012/06/get-url-parameters-using-jquery.html\n*/\nfunction getURLParameter(sParam) {\n    var sPageURL = window.location.search.substring(1);\n    var sURLVariables = sPageURL.split('&');\n    var i, sParameterName;\n\n    for (i = 0; i < sURLVariables.length; i = i + 1) {\n        sParameterName = sURLVariables[i].split('=');\n        if (sParameterName[0] === sParam) {\n            return sParameterName[1];\n        }\n    }\n}\n\nfunction toggleIt(element) {\n    $('#' + element).slideToggle( 'slow' );\n}\n"],"file":"worstnightmare.dev.js"}